# Copyright 2023 The Fuchsia Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("//build/bazel/bazel_action.gni")
import("//build/bazel/bazel_inputs.gni")

# See README.txt for details

# This bazel_input_resource() target *must* *not* be reachable from the
# global legacy list.
bazel_input_resource("bazel_input") {
  name = "04_unlisted_legacy_input_dependency"
  sources = [ "foo.in.txt" ]
  outputs = sources
}

# An empty group since this test must fail.
group("test") {
}

# The target being tested, which will fail because its bazel_inputs dependency
# is not part of the global list used to populate @legacy_ninja_build_outputs.
# :bazel_inputs in its `bazel_inputs` list.
bazel_action("test_must_fail") {
  command = "build"
  bazel_targets = [ ":copy_input" ]
  bazel_inputs = [ ":bazel_input" ]
  bazel_outputs = [ "{{BAZEL_TARGET_OUT_DIR}}/foo.out.txt" ]
  ninja_outputs = [ "foo.ninja.out" ]
}
