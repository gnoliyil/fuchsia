# Copyright 2019 The Fuchsia Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("//build/zircon/zx_library.gni")

zx_library("fidl-async-cpp") {
  sdk = "source"
  sdk_headers = [
    "lib/fidl-async/cpp/bind.h",
    "lib/fidl-async/cpp/channel_transaction.h",
  ]
  sources = [
    "llcpp_bind.cc",
    "llcpp_channel_transaction.cc",
  ]
  deps = [
    "//sdk/lib/fidl",
    "//sdk/lib/fidl/cpp/wire",
    "//sdk/lib/fit",
    "//zircon/system/ulib/async",
  ]
  public_deps = [
    "//sdk/lib/fit",

    # <lib/fidl-async/cpp/channel_transaction.h> has #include <lib/zx/channel.h>.
    "//zircon/system/ulib/zx",
  ]

  # TODO(https://fxbug.dev/116293): This library is deprecated.
  # Consider using `fidl::BindServer`, which does not require any additional helper
  # libraries apart from the generated C++ FIDL bindings.
  visibility = [
    ":fidl-async-cpp_cc_stub",
    "test:fidl-async-test",
    "//src/graphics/display/drivers/aml-hdmi:*",
    "//src/graphics/display/drivers/amlogic-display:*",
    "//src/graphics/display/drivers/intel-i915:*",
    "//src/graphics/display/drivers/virtio-guest:*",
    "//src/graphics/drivers/misc/goldfish:*",
    "//src/graphics/drivers/misc/goldfish_address_space:*",
    "//src/storage/bin/disk-pave:*",
    "//src/storage/blobfs:*",
    "//src/storage/f2fs:*",
    "//src/storage/factory/factoryfs:*",
    "//src/storage/lib/paver:*",
    "//src/storage/lib/paver/test:*",
    "//src/storage/minfs:*",
    "//src/storage/testing:*",
  ]
}

group("tests") {
  testonly = true
  deps = [ "test:tests" ]
}
